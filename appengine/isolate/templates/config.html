{% set title = 'Isolate Server Google Storage Config' %}
{% extends "isolate/base.html" %}

{% block body %}

<h1>Server global config</h1>

Last updated by: <strong>{{ updated_by }}</strong>.<br>
Last updated on: <strong>{{ updated_ts|datetimeformat }}</strong>.<br>

<form method="post">
  <h2>Cache</h2>
  <div>
    Default expiration (secs):<br />
    <input type="text" name="default_expiration" value="{{ default_expiration }}" size="60" />
  </div>
  <h2>Google storage</h2>
  See this <a href="https://developers.google.com/storage/docs/accesscontrol#About-the-Client-ID">
  page</a> for instructions on how to setup Service account for API Access to Google Storage.
  <p>
  <div>
    Google Storage Bucket:<br />
    <input type="text" name="gs_bucket" value="{{ gs_bucket }}" size="60" />
  </div>
  <br>
  <div>
    API access client email address:<br />
    <input type="text" name="gs_client_id_email" value="{{ gs_client_id_email }}" size="60" />
  </div>
  <br>
  <div>
    API access base64 encoded *.der private key:<br />
    <textarea rows="14" cols="80" name="gs_private_key">{{ gs_private_key }}</textarea>
  </div>
  <br>
  <input type="hidden" name="xsrf_token" value="{{ xsrf_token }}" />
  <input type="submit" value="Submit" />
</form>
<br>

<hr>

<p>To convert secret.p12 key generated by API Console into base64 encoded
*.der key use this script:
<pre>
  # Convert *.p12 to *.pem. Use password 'notasecret'.
  openssl pkcs12 -in secret.p12 -nodes -nocerts > secret.pem
  # Convert *.pem into *.der.
  openssl rsa -in secret.pem -inform PEM -out secret.der -outform DER
  # Base64 encode *.der and copy-paste it into the form above.
  cat secret.der | base64
  # Remove temp files.
  rm secret.der secret.pem
</pre>
</p>

{% endblock %}
