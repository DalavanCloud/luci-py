{% extends "swarming/base.html" %}


{% block headers %}
<style>
  h1 {
    margin-top: 10px;
    margin-bottom: 10px;
  }
</style>
{% endblock %}


{% block floating %}
<br>{{now|datetimeformat}}
{% endblock %}


{% block body %}
{% import 'swarming/bot_view.html' as bot_view %}

<h1>Known bots</h1>
<a href="/">Back to root</a>
<p>

<p>Sort By:
<select id="sort" onchange="document.location.href='?sort_by=' + this.value">
  {% for sort_option in sort_options %}
    {% if sort_option.key == selected_sort %}
      <option value="{{sort_option.key}}" selected="">{{sort_option.name}}
      </option>
    {% else %}
      <option value="{{sort_option.key}}">{{sort_option.name}}</option>
    {% endif %}
  {% endfor %}
</select>
</p>
<p>
Current bot version is: {{current_version[:8]}}
</p>

{% import 'swarming/bot_view.html' as bot_view %}
<table id="machine-table" class="alterning_background"
    summary="This table lists all machines that have polled this server">
  <thead>
    <th>ID</th>
    <th>Task</th>
    <th>Last Seen</th>
    <th>Dimensions</th>
    <th>Version</th>
  </thead>
  <tbody>
    {% for bot in bots %}
      <tr class="request {% if bot.last_seen < dead_machine_cutoff %}dead_machine{% endif %}">
        <td>{{bot_view.bot_link(bot.key.id(), is_privileged_user)}}</td>
        <td>
          {% if bot.task %}
          <a href="/user/task/{{bot.task_entity.key_string}}">
            {{bot.task_entity.name}}</a>
          {% else %}&#8209;&#8209;{% endif%}
        </td>
        <td>
          {{(now-bot.last_seen)|timedeltaformat}}
          {% if is_admin and bot.last_seen < dead_machine_cutoff %}
            <form id="delete_{{bot.key.id()}}" method="post"
                action="/delete_machine_stats">
              <input type="hidden" name="r" value="{{bot.key.id()}}" />
              <input type="submit" value="Delete" />
            </form>
          {% endif %}
        </td>
        <td>{{bot_view.render_dimensions(bot.dimensions)}}</td>
        <td>{{bot.version[:8]}}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}
